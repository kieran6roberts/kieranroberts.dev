---
import Layout from "../layouts/Layout.astro";
import { LoadMorePosts } from "../components/blog/LoadMorePosts";
import { fetchPaginatedBlogPosts, getPostsPaginatedData } from "../utils/blog";

const blogPosts = await fetchPaginatedBlogPosts({ first: null, after: null });
const { cursor, hasNextPage, postsArray } = getPostsPaginatedData(blogPosts);
---

<Layout
  title="Blog | Kieran Roberts"
  description="I like about React, Next.js, TypeScript, and web development in general. Find something you like here."
  url="kieranroberts.dev/contact"
  showFooter={false}
>
  <main class="px-4 md:px-16 py-16 w-full flex flex-col">
    <h1
      class="font-header text-l-secondary dark:text-d-tertiary-2 text-4xl text-center font-semibold mb-8"
    >
      My blog
    </h1>
    <section class="max-w-[600px] mx-auto">
      <div class="flex flex-col gap-y-12">
        {
          postsArray.map((post) => (
            <article>
              <a class="flex flex-col gap-y-2" href={`/blog/${post.slug}`}>
                <h2 class="max-w-[450px] mx-auto text-center prose-xl dark:prose-invert">
                  {post.title}
                </h2>
                <p class="prose dark:prose-invert text-justify">{post.brief}</p>
              </a>
            </article>
          ))
        }
        {
          hasNextPage ? (
            <LoadMorePosts
              client:visible
              hasNextPage={hasNextPage}
              cursor={cursor}
            />
          ) : null
        }
      </div>
    </section>
  </main>
</Layout>
