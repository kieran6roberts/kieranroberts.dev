---
import Layout from "@layouts/Layout.astro";
import { LoadMorePosts } from "@modules/blog/LoadMorePosts";
import { fetchPaginatedBlogPosts, getPostsPaginatedData } from "@utils/blog";
import PageTitle from "@layouts/PageTitle.astro";
import ScrollUp from "@components/navigation/ScrollUp.astro";
import { ArticleCard } from "@modules/blog/ArticleCard";
import { ArrowUpSVG, RSSSVG } from "@components/icons";
import { Button } from "@components/base/Button";

const blogPosts = await fetchPaginatedBlogPosts({ first: null, after: null });
const { cursor, hasNextPage, postsArray } = getPostsPaginatedData(
  blogPosts as any
);
---

<Layout
  title="Blog | Kieran Roberts"
  description="I like about React, Next.js, TypeScript, and web development in general. Find something you like here."
  url="kieranroberts.dev/blog"
>
  <main id="main" class="px-8 md:px-16 py-16 w-full flex flex-col gap-4">
    <PageTitle>
      <a
        href="https://twitter.com/Kieran6dev"
        class="text-[1.2em] p-1 rounded-lg">@Kieran6Dev</a
      >
      <br />Blog
    </PageTitle>
    <Button
      client:load
      variant="transparent"
      className="flex items-center mx-auto mb-6"
      asLink
      href="/blog/rss.xml"
      iconAnimationSettings={{ x: 2, scale: 1.03 }}
      childrenIsIcon
      startIcon={null}
      endIcon={null}
      aria-label="Kieran6Dev RSS feed"
    >
      <div class="flex items-center gap-2">
        <span class="inline-block">RSS feed</span>
        <span class="flex w-5 h-5 text-white">
          <RSSSVG />
        </span>
      </div>
    </Button>
    <section class="max-w-[600px] mx-auto">
      <div class="flex flex-col gap-y-12">
        {
          postsArray.map((post) => (
            <>
              <a
                href={`/blog/${post.slug}`}
                class="group link-focus rounded-xl"
              >
                <ArticleCard
                  title={post.title}
                  description={post.brief}
                  date={post.publishedAt}
                  options={{ formatDate: true }}
                />
              </a>
            </>
          ))
        }
        {
          hasNextPage ? (
            <LoadMorePosts
              client:visible
              hasNextPage={hasNextPage}
              cursor={cursor as any}
            />
          ) : null
        }
      </div>
    </section>
  </main>
  <ScrollUp>
    <span class="w-4 h-4 block text-white">
      <ArrowUpSVG />
    </span>
  </ScrollUp>
</Layout>
